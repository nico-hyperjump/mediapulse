---
title: Quality Assurance Agent
---

## Purpose

Validate newsletter content for accuracy, quality, compliance, and completeness before delivery.

## Inputs

- `ticker: string` - Company identifier
- `userId: string` - User identifier
- `newsletterId: string` - Newsletter identifier

**Note**: The agent reads newsletter content, source data, and analysis results directly from the database. It does not receive data from the Content Generation Agent or other agents. The agent works independently and queries the database for the necessary data.

## Configurations

```typescript
{
  factChecking: {
    enabled: true,
    strictness: 'high' | 'medium' | 'low',
    verifyNumbers: true,
    verifyDates: true,
    verifyQuotes: true,
    crossReferenceSources: true
  },
  quality: {
    minScore: 0.7, // 0-1 scale
    checkReadability: true,
    checkCompleteness: true,
    checkConsistency: true,
    checkGrammar: true
  },
  compliance: {
    disclaimers: {
      required: true,
      template: string
    },
    financialAdvice: {
      prohibited: true,
      checkLanguage: true
    },
    dataAttribution: {
      required: true,
      format: string
    }
  },
  ai: {
    factCheckModel: 'gpt-4',
    qualityModel: 'gpt-4',
    temperature: 0.2
  }
}
```

## Outputs

```typescript
{
  agentId: 'quality-assurance',
  agentVersion: string,                 // Semantic version (e.g., "1.2.3") of the agent that generated this output
  newsletterId: string,
  timestamp: Date,
  executionTime: number,
  validation: {
    passed: boolean,
    score: number, // 0-1 overall quality score
    checks: {
      factChecking: {
        passed: boolean,
        score: number,
        issues: Array<{
          section: string,
          claim: string,
          issue: string,
          severity: 'critical' | 'warning' | 'info',
          suggestedFix?: string
        }>
      },
      quality: {
        passed: boolean,
        score: number,
        metrics: {
          readability: number,
          completeness: number,
          consistency: number,
          grammar: number
        },
        issues: Array<{
          type: string,
          description: string,
          severity: 'critical' | 'warning' | 'info'
        }>
      },
      compliance: {
        passed: boolean,
        issues: Array<{
          rule: string,
          violation: string,
          severity: 'critical' | 'warning',
          requiredFix: string
        }>
      }
    }
  },
  recommendations: Array<{
    priority: 'high' | 'medium' | 'low',
    section: string,
    issue: string,
    fix: string
  }>,
  approved: boolean,
  requiresRevision: boolean
}
```

## Process

1. **Initialize**: Load compliance rules, QA config
2. **Read Data**: Query database for newsletter content, source data, and analysis results (independent of other agents)
3. **Fact-Checking**:

   - Extract all factual claims from newsletter
   - Cross-reference with source data (news articles, market data)
   - Verify numbers (prices, metrics, dates)
   - Check quotes and attributions
   - Use AI to verify complex claims
   - Flag discrepancies

3. **Quality Assessment**:

   - **Readability**: Check sentence length, complexity
   - **Completeness**: Ensure all required sections present
   - **Consistency**: Check for contradictions, style consistency
   - **Grammar**: Basic grammar/spelling check
   - Calculate overall quality score

4. **Compliance Check**:

   - Verify required disclaimers present
   - Check for prohibited language (financial advice)
   - Verify data attribution
   - Check regulatory compliance

5. **Issue Aggregation**:

   - Collect all issues from checks
   - Prioritize by severity
   - Generate recommendations

6. **Decision**:

   - If critical issues: `approved = false`, `requiresRevision = true`
   - If only warnings: `approved = true`, add recommendations
   - If passed: `approved = true`

7. **Write Results**: Store validation results and approval status in database

8. **Note on Retries**: The QA Agent does not directly trigger content generation retries. It writes `requiresRevision: true` to the database. The Scheduler Agent (or a separate retry mechanism) monitors QA results and can enqueue a Content Generation retry job if needed.

9. **Return**: Validation results

## Sequence Diagram

<Mermaid
  chart="
flowchart TD
    A[Scheduler] --> B[Quality Assurance Agent<br/>Triggered independently]
    B --> C[Agent reads newsletter from Database]
    C --> C2[Agent reads source data from Database]
    C2 --> C3[Agent reads analysis results from Database]
    C3 --> D[Parallel QA Checks]
    
    D --> E1[Fact Checker<br/>Extract claims<br/>Cross-reference sources<br/>Verify numbers/dates<br/>AI: Verify complex claims]
    D --> E2[Quality Scorer<br/>Readability analysis<br/>Completeness check<br/>Consistency check<br/>Grammar check<br/>Calculate score]
    D --> E3[Compliance Checker<br/>Check disclaimers<br/>Check prohibited language<br/>Verify attribution]
    
    E1 --> F[Aggregate issues & generate recommendations]
    E2 --> F
    E3 --> F
    
    F --> G{Decision}
    G -->|Approved| H[Write approval status to Database]
    G -->|Requires Revision| H
    H --> I[QA complete<br/>Status available for Delivery Agent]
"
/>
